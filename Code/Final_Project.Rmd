---
title: "Final Project"
author: "Cassidy White, Stephanie Kinser, and Katie Owen"
date: "4/2/2022"
output: pdf_document
---
```{r}
getwd()
```

```{r set libraries and theme}
library(dplyr)
library(tidyverse)
library(ggplot2)
library(lubridate)

mytheme <- theme_classic(base_size = 14) +
  theme(axis.text = element_text(color = "black"), 
        legend.position = "right") + 
  theme_bw()
theme_set(mytheme)
```


```{r load the data}
climate<-read.csv("./Data/Processed/BlueMesaClimate.csv")
power<-read.csv("./Data/Raw/BLUEMESAPOWERPLANT.csv")
reservoir<-read.csv("./Data/Processed/BlueMesaReservoir.csv")
```

```{r wrangle the data}
#getting dates in the proper format 
climate$Date <-as.Date(climate$Date, format = "%Y-%d")
climate <-climate %>%
  mutate(Year = year(Date)) %>%
  mutate(Month = rep(1:12, 19)) %>%
  select(-c(Date))
climate$Date<-sprintf("%d-%02d", climate$Year, climate$Month)
climate<-climate %>%
  select(-c(Year, Month))

power<-power %>%
  rename(Date = Ã¯..Date)%>%
  subset(select = c(Date, MWH))

power$Date <- as.Date(power$Date, format = "%d-%b-%y")
power<-power %>%
  mutate(Month = month(Date)) %>%
  mutate(Year = year(Date))%>%
  select(-c(Date))
power$Date<-sprintf("%d-%02d", power$Year, power$Month)
power<- power %>%
  select(-c(Year, Month))

col_order<-c("Date", "MWH")
power<-power[, col_order]

reservoir$Date <- as.Date(reservoir$Date, format = "%d-%b-%y")
reservoir<-reservoir %>%
  mutate(Month = month(Date)) %>%
  mutate(Year = year(Date))%>%
  select(-c(Date))
reservoir$Date<-sprintf("%d-%02d", reservoir$Year, reservoir$Month)
reservoir<-reservoir %>%
  select(-c(Year, Month))

#make a gathered data set for data viz
climate.longer<-pivot_longer(climate, MaxT:MinT, names_to = "Min/Max", values_to = "Temperature")

#make a gathered data set for data viz
reservoir.longer<-reservoir %>%
  pivot_longer(Inflow.cfs:Total.cfs, names_to = "Flow_Type", values_to = "Flow_(cfs)") %>%
  pivot_longer(Storage.af:Evaporation.af, names_to = "Volume_Type", values_to = "Volume_(af)")

#combine power and reservoir data
all.data<-left_join(reservoir, climate)
all.data<-left_join(all.data, power)
```

```{r visual exploration}
#min and max temperature over time
ggplot(climate.longer) +
  geom_point(aes(x = Date, y = Temperature, group = `Min/Max`, color = `Min/Max`)) +
  labs(y="Temperature (F)", color = "Legend")

#power production over time
ggplot(power, aes(x=Date, y=MWH))+
  geom_line()

#reservoir elevation over time
ggplot(reservoir, aes(x=Date, y = Elevation.ft))+
  geom_line(color = "blue")+
  ylab("Reservoir Elevation (ft)")

#reservoir volume over time
ggplot(reservoir.longer, aes(x=Date, y = `Volume_(af)`, color = `Volume_Type`))+
  geom_line()+
  labs(y = "Volume (af)", color = "Legend")

#reservoir total flow over time
ggplot(reservoir, aes(x=Date, y = Total.cfs))+
  geom_line(color = "blue")+
  labs(y = "Total Flow (cfs)")

#reservoir power production by power.cfs
#I want to do a second axis here but it isn't working. Would also need to add a legend.
ggplot(power.res, aes(x=Date))+
  geom_line(aes(y=Power.cfs), color = "blue")+
  geom_line(aes(y=MWH), color = "red")+
  scale_y_continuous(
    name = "Power Flow (cfs)"#,
    #sec_axis(name = waiver(MWH))
    )
```

